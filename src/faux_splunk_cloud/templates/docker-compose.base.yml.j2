# Faux Splunk Cloud - Docker Compose Base Template
# Uses default.yml for configuration as per Splunk docker project best practices
#
# Reference: https://splunk.github.io/docker-splunk/
#
# Generated by Faux Splunk Cloud
# Instance: {{ instance_id }}
# Topology: {{ topology }}

version: "3.8"

networks:
  {{ network_name }}:
    driver: bridge
    name: {{ network_name }}

{% block volumes %}
volumes:
  # Default volumes - override in topology-specific templates
{% endblock %}

x-splunk-common: &splunk-common
  image: {{ splunk_image }}
  networks:
    - {{ network_name }}
  restart: unless-stopped
  mem_limit: {{ memory_limit }}m
  cpus: {{ cpu_limit }}
  labels:
    com.faux-splunk-cloud.instance-id: "{{ instance_id }}"
    com.faux-splunk-cloud.topology: "{{ topology }}"
    com.faux-splunk-cloud.experience: "{{ experience }}"
    com.faux-splunk-cloud.created-at: "{{ created_at }}"
    com.faux-splunk-cloud.expires-at: "{{ expires_at }}"
  # Use SPLUNK_DEFAULTS_URL to fetch default.yml configuration
  # This is the recommended approach per Splunk docker project
  environment:
    SPLUNK_START_ARGS: "--accept-license"
    SPLUNK_LICENSE_URI: "Free"
  healthcheck:
    test: ["CMD", "curl", "-k", "-f", "https://localhost:8089/services/server/health/splunkd"]
    interval: 30s
    timeout: 10s
    retries: 10
    start_period: 180s

{% block services %}
services:
  # Services defined in topology-specific templates
{% endblock %}
